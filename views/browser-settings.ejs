<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>浏览器设置 - AI模型管理工具</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .settings-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .performance-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .perf-max {
            background: linear-gradient(135deg, #10b981, #34d399);
            color: white;
        }
        .perf-high {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }
        .perf-balanced {
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            color: white;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="bi bi-cpu"></i> AI模型管理工具
            </a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">提供商列表</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/browser-settings">浏览器设置</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- 页面标题 -->
        <div class="header-actions">
            <div>
                <h1 class="mb-1">
                    <i class="bi bi-gear"></i> 浏览器设置
                </h1>
                <p class="text-muted mb-0">配置网页AI服务转换功能</p>
            </div>
        </div>

        <!-- 功能状态 -->
        <div class="settings-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="mb-2">功能状态</h5>
                    <p class="text-muted mb-0" id="statusText">加载中...</p>
                </div>
                <div>
                    <span class="performance-badge perf-max" id="perfBadge">极致性能</span>
                </div>
            </div>
        </div>

        <!-- 性能配置 -->
        <div class="settings-card">
            <h5 class="mb-3">性能参数</h5>
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">连接超时 (秒)</label>
                    <input type="number" class="form-control" id="connectionTimeout"
                           value="5" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label">操作延迟 (秒)</label>
                    <input type="number" class="form-control" id="actionDelay"
                           value="0.05" step="0.01" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label">流检测间隔 (秒)</label>
                    <input type="number" class="form-control" id="streamInterval"
                           value="0.1" step="0.01" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label">元素超时 (秒)</label>
                    <input type="number" class="form-control" id="elementTimeout"
                           value="2" readonly>
                </div>
            </div>
            <div class="alert alert-info mt-3">
                <i class="bi bi-info-circle me-2"></i>
                当前使用极致性能模式，所有参数已优化到最大值
            </div>
        </div>

        <!-- 快捷操作 -->
        <div class="settings-card">
            <h5 class="mb-3">快捷操作</h5>
            <div class="d-flex gap-2">
                <button class="btn btn-primary" onclick="openBrowserPage()">
                    <i class="bi bi-browser-chrome me-2"></i>打开浏览器管理
                </button>
                <button class="btn btn-outline-secondary" onclick="testBrowser()">
                    <i class="bi bi-activity me-2"></i>测试连接
                </button>
            </div>
        </div>

        <!-- 配置详情（可展开） -->
        <div class="card">
            <div class="card-header">
                <a class="d-flex justify-content-between text-decoration-none"
                   data-bs-toggle="collapse" href="#configDetails">
                    <span>完整配置详情</span>
                    <i class="bi bi-chevron-down"></i>
                </a>
            </div>
            <div class="collapse" id="configDetails">
                <div class="card-body">
                    <pre id="configJson" class="mb-0" style="font-size: 12px;">
                        加载中...
                    </pre>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            await loadConfig();
        });

        async function loadConfig() {
            try {
                const response = await fetch('/api/browser/config');
                const data = await response.json();

                // 更新状态
                document.getElementById('statusText').textContent =
                    data.enabled ? '✅ 已启用' : '❌ 已禁用';

                // 更新配置显示
                document.getElementById('configJson').textContent =
                    JSON.stringify(data.performance, null, 2);

                // 更新性能参数显示
                const constants = data.performance.browser.constants;
                document.getElementById('connectionTimeout').value = constants.CONNECTION_TIMEOUT;
                document.getElementById('actionDelay').value = constants.ACTION_DELAY_MIN;
                document.getElementById('streamInterval').value = constants.STREAM_CHECK_INTERVAL_DEFAULT;
                document.getElementById('elementTimeout').value = constants.DEFAULT_ELEMENT_TIMEOUT;

            } catch (error) {
                console.error('加载配置失败:', error);
            }
        }

        function openBrowserPage() {
            window.location.href = '/browser';
        }

        async function testBrowser() {
            try {
                const response = await fetch('/v1/browser/health');
                const data = await response.json();

                if (data.service === 'healthy') {
                    alert('✅ 浏览器连接正常');
                } else {
                    alert('❌ 浏览器连接异常: ' + (data.error || '未知错误'));
                }
            } catch (error) {
                alert('❌ 测试失败: ' + error.message);
            }
        }
    </script>
</body>
</html>
