<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API 文档 - AI模型管理工具</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 50%, #e2e8f0 100%);
            min-height: 100vh;
        }
        .api-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .method-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 6px;
            font-weight: 600;
            min-width: 80px;
            text-align: center;
        }
        .method-get { background: #10b981; color: white; }
        .method-post { background: #6366f1; color: white; }
        .method-delete { background: #ef4444; color: white; }
        .method-put { background: #f59e0b; color: white; }
        .endpoint {
            font-family: 'Consolas', 'Monaco', monospace;
            background: #f1f5f9;
            padding: 8px 16px;
            border-radius: 6px;
            margin-top: 8px;
        }
        .copy-btn {
            background: none;
            border: none;
            color: #6366f1;
            cursor: pointer;
        }
        .copy-btn:hover {
            color: #4f46e5;
        }
        .nav-pills {
            background: white;
            padding: 8px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .nav-link {
            border-radius: 8px;
            color: #64748b;
            margin: 2px;
        }
        .nav-link.active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="bi bi-cpu"></i> AI模型管理工具
            </a>
            <div class="navbar-nav">
                <a class="nav-link" href="/">提供商列表</a>
                <a class="nav-link" href="/browser">浏览器自动化</a>
                <a class="nav-link" href="/oauth">OAuth管理</a>
                <a class="nav-link active" href="/api-docs">API 文档</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-3">
                <div class="nav flex-column nav-pills">
                    <a class="nav-link active" data-tab="unified">统一 API</a>
                    <a class="nav-link" data-tab="openai">OpenAI 兼容</a>
                    <a class="nav-link" data-tab="browser">浏览器自动化</a>
                    <a class="nav-link" data-tab="oauth">OAuth 管理</a>
                    <a class="nav-link" data-tab="cookie">Cookie 管理</a>
                    <a class="nav-link" data-tab="examples">使用示例</a>
                </div>
            </div>
            <div class="col-md-9">
                <!-- 统一 API 网关 -->
                <div id="tab-unified" class="tab-content">
                    <h2 class="mb-4"><i class="bi bi-globe"></i> 统一 API 网关</h2>
                    <p class="text-muted mb-4">
                        统一的所有 AI 服务入口，自动路由到已配置的 API 或浏览器自动化服务
                    </p>

                    <div class="api-section">
                        <h5>聊天完成</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-post">POST</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /v1/ai/chat/completions
                                    <button class="copy-btn" onclick="copyText('/v1/ai/chat/completions')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                                <div class="mt-2">
                                    <strong>请求体:</strong>
                                    <pre class="bg-light p-2 mt-1"><code>{
  "provider": "openai",  // openai, browser, auto
  "model": "gpt-4",
  "messages": [
    { "role": "user", "content": "Hello!" }
  ],
  "stream": true
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5>获取模型列表</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-get">GET</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /v1/ai/models
                                    <button class="copy-btn" onclick="copyText('/v1/ai/models')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5>网关信息</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-get">GET</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /v1/ai/info
                                    <button class="copy-btn" onclick="copyText('/v1/ai/info')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- OpenAI 兼容 API -->
                <div id="tab-openai" class="tab-content" style="display:none;">
                    <h2 class="mb-4"><i class="bi bi-box-seam"></i> OpenAI 兼容 API</h2>
                    <p class="text-muted mb-4">
                        完全兼容 OpenAI API 格式，可被原生 OpenAI SDK 调用
                    </p>

                    <div class="api-section">
                        <h5>聊天完成</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-post">POST</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /v1/chat/completions
                                    <button class="copy-btn" onclick="copyText('/v1/chat/completions')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5>图片生成</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-post">POST</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /v1/images/generations
                                    <button class="copy-btn" onclick="copyText('/v1/images/generations')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5>音频转录</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-post">POST</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /v1/audio/transcriptions
                                    <button class="copy-btn" onclick="copyText('/v1/audio/transcriptions')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5>嵌入向量</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-post">POST</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /v1/embeddings
                                    <button class="copy-btn" onclick="copyText('/v1/embeddings')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5>获取模型列表</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-get">GET</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /v1/models
                                    <button class="copy-btn" onclick="copyText('/v1/models')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 浏览器自动化 API -->
                <div id="tab-browser" class="tab-content" style="display:none;">
                    <h2 class="mb-4"><i class="bi bi-browser-chrome"></i> 浏览器自动化 API</h2>
                    <p class="text-muted mb-4">
                        将网页版 AI 服务转换为 API，支持 Cookie 和 OAuth 认证
                    </p>

                    <div class="api-section">
                        <h5>浏览器聊天</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-post">POST</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /v1/browser/chat/completions
                                    <button class="copy-btn" onclick="copyText('/v1/browser/chat/completions')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5>浏览器健康检查</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-get">GET</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /v1/browser/health
                                    <button class="copy-btn" onclick="copyText('/v1/browser/health')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5>获取浏览器模型</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-get">GET</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /v1/browser/models
                                    <button class="copy-btn" onclick="copyText('/v1/browser/models')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5>打开网站</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-post">POST</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /api/browser/open
                                    <button class="copy-btn" onclick="copyText('/api/browser/open')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                                <div class="mt-2">
                                    <strong>请求体:</strong>
                                    <pre class="bg-light p-2 mt-1"><code>{ "domain": "chatgpt.com" }</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5>获取配置</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-get">GET</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /api/browser/config
                                    <button class="copy-btn" onclick="copyText('/api/browser/config')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                 <!-- OAuth 管理 -->
                <div id="tab-oauth" class="tab-content" style="display:none;">
                    <h2 class="mb-4"><i class="bi bi-shield-lock"></i> OAuth 管理</h2>
                    <p class="text-muted mb-4">
                        支持 OAuth 2.0 认证流程，自动管理 Token 刷新和授权流程
                    </p>

                    <div class="api-section">
                        <h5>获取所有 OAuth 提供商</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-get">GET</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /api/oauth/providers
                                    <button class="copy-btn" onclick="copyText('/api/oauth/providers')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5>获取 OAuth 统计信息</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-get">GET</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /api/oauth/stats
                                    <button class="copy-btn" onclick="copyText('/api/oauth/stats')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5>生成授权 URL</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-get">GET</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /api/oauth/authorize/:name
                                    <button class="copy-btn" onclick="copyText('/api/oauth/authorize/:name')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                                <div class="mt-2">
                                    <strong>参数:</strong>
                                    <ul>
                                        <li>name: OAuth提供商名称</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5>处理 OAuth 回调</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-get">GET</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /api/oauth/callback/:name
                                    <button class="copy-btn" onclick="copyText('/api/oauth/callback/:name')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5>刷新 Access Token</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-post">POST</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /api/oauth/tokens/:name/refresh
                                    <button class="copy-btn" onclick="copyText('/api/oauth/tokens/:name/refresh')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5>撤销 Token</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-delete">DELETE</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /api/oauth/tokens/:name
                                    <button class="copy-btn" onclick="copyText('/api/oauth/tokens/:name')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5><i class="bi bi-info-circle text-primary"></i> OAuth 使用方式</h5>
                        <p>OAuth 2.0 认证流程：</p>
                        <ol class="mt-3">
                            <li>在管理界面添加 OAuth 提供商配置</li>
                            <li>调用 <code>/api/oauth/authorize/:name</code> 获取授权URL</li>
                            <li>打开授权URL，完成OAuth授权</li>
                            <li>系统自动回调并保存 Access Token</li>
                            <li>Token 过期前自动刷新</li>
                        </ol>

                        <div class="alert alert-info mt-3">
                            <i class="bi bi-lightbulb"></i>
                            <strong>提示：</strong>
                            Token 会自动加密存储，支持自动过期检测和自动刷新。
                        </div>
                    </div>
                </div>

                <!-- Cookie 管理 -->
                <div id="tab-cookie" class="tab-content" style="display:none;">
                    <h2 class="mb-4"><i class="bi bi-cookie"></i> Cookie 管理</h2>
                    <p class="text-muted mb-4">
                        支持加密存储、导入导出和自动过期检测
                    </p>

                    <div class="api-section">
                        <h5>获取所有 Cookies</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-get">GET</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /api/browser/cookies
                                    <button class="copy-btn" onclick="copyText('/api/browser/cookies')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5>保存 Cookie</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-post">POST</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /api/browser/cookies
                                    <button class="copy-btn" onclick="copyText('/api/browser/cookies')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="api-section">
                        <h5>删除 Cookie</h5>
                        <div class="d-flex align-items-start">
                            <span class="method-badge method-delete">DELETE</span>
                            <div class="flex-grow-1">
                                <div class="endpoint">
                                    /api/browser/cookies/:domain
                                    <button class="copy-btn" onclick="copyText('/api/browser/cookies/:domain')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 使用示例 -->
                <div id="tab-examples" class="tab-content" style="display:none;">
                    <h2 class="mb-4"><i class="bi bi-code-slash"></i> 使用示例</h2>

                    <div class="api-section">
                        <h5>JavaScript / Node.js</h5>
                        <pre class="bg-dark text-light p-3 rounded"><code>// 使用 OpenAI SDK 调用统一 API
import OpenAI from 'openai';

const client = new OpenAI({
  baseURL: 'http://localhost:3000/v1',
  apiKey: 'your-api-key-or-empty-for-browser'
});

const completion = await client.chat.completions.create({
  model: 'gpt-4',
  messages: [{ role: 'user', content: 'Hello!' }],
  stream: true
});

// 使用统一网关
const response = await fetch('http://localhost:3000/v1/ai/chat/completions', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    provider: 'auto',  // auto, openai, browser
    model: 'gpt-4',
    messages: [{ role: 'user', content: 'Hello!' }].
    stream: true
  })
});</code></pre>
                    </div>

                    <div class="api-section">
                        <h5>Python</h5>
                        <pre class="bg-dark text-light p-3 rounded"><code>import openai
import requests

# 使用 OpenAI SDK
client = openai.OpenAI(
    base_url="http://localhost:3000/v1",
    api_key="your-key"
)

response = client.chat.completions.create(
    model="gpt-4",
    messages=[{"role": "user", "content": "Hello!"}],
    stream=True
)

# 使用统一网关
response = requests.post(
    "http://localhost:3000/v1/ai/chat/completions",
    json={
        "provider": "auto",
        "model": "gpt-4",
        "messages": [{"role": "user", "content": "Hello!"}],
        "stream": True
    }
)</code></pre>
                    </div>

                    <div class="api-section">
                        <h5>cURL</h5>
                        <pre class="bg-dark text-light p-3 rounded"><code># 统一网关
curl -X POST http://localhost:3000/v1/ai/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "auto",
    "model": "gpt-4",
    "messages": [{"role": "user", "content": "Hello!"}]
  }'

# OpenAI 兼容
curl -X POST http://localhost:3000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gpt-4",
    "messages": [{"role": "user", "content": "Hello!"}]
  }'

# 浏览器自动化
curl -X POST http://localhost:3000/v1/browser/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gpt-4",
    "messages": [{"role": "user", "content": "Hello!"}]
  }'</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 标签切换
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const tab = this.dataset.tab;

                // 更新导航状态
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');

                // 切换内容
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.style.display = 'none';
                });
                document.getElementById('tab-' + tab).style.display = 'block';
            });
        });

        // 复制文本
        function copyText(text) {
            navigator.clipboard.writeText(text).then(() => {
                // 可以添加复制成功提示
                const btn = event.target.closest('button');
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<i class="bi bi-check"></i>';
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                }, 1000);
            });
        }
    </script>
</body>
</html>
